<!DOCTYPE html>
<html lang="en">

<head>
    <title>RMSI CSV Generator</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width" />

    <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@material-ui/core@latest/umd/material-ui.production.min.js"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/babel-standalone@latest/babel.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">

        /* ----- BEGIN: MUI Setup ----- */
        //Import MUI components
        const {
            colors,
            CssBaseline,
            ThemeProvider,
            Typography,
            Container,
            makeStyles,
            createMuiTheme,
            useTheme,
            Box,
            SvgIcon,
            Link,
            Paper,
            TextField,
            Button,
            Select,
            FormControl,
            FormHelperText,
            InputLabel,
            MenuItem,
            FormControlLabel,
            Checkbox,
            Grid,
            Input,
            MenuProps,
            Chip
        } = MaterialUI;

        // Create a MUI theme instance.
        const theme = createMuiTheme({
            palette: {
                primary: {
                    main: '#556cd6',
                },
                secondary: {
                    main: '#19857b',
                },
                error: {
                    main: colors.red.A400,
                },
                background: {
                    default: '#f5f5f5',
                },
            },
        });

        const useStyles = makeStyles(theme => ({
            htmlBody:{
                background: "#f5f5f5",
            },
            root: {
                margin: theme.spacing(6, 0, 3),
            },
            mainContainer: {
                margin: "20px",
                padding: "20px"
            },
            formControl: {
                margin: theme.spacing(1),
                minWidth: 240,
            },
            chips: {
                display: 'flex',
                flexWrap: 'wrap',
            },
            chip: {
                margin: 2,
            },
            chosenCountry: {
                color: theme.palette.primary.main,
                background: "blue",
            },
            normalCountry: {

            },
            formTitle:{
                color: theme.palette.primary.main,
            }

        }));
        /* ----- END: MUI Setup ----- */

        /* ----- BEGIN: CSV Helpers ----- */
        const fields = {
            filename: { name: "Filename", type: "", default_value: "", required_on_create: true },
            title: { name: "Title", type: "", default_value: "", required_on_create: true },
            territories: { name: "Territories", type: "", default_value: "", required_on_create: true },
            description: { name: "Description", type: "", default_value: "", required_on_create: true },
            category: { name: "Category", type: "", default_value: "", required_on_create: true },
            monitoring_type: { name: "Monitoring Type", type: "", default_value: "", required_on_create: true },
            match_rule_id: { name: "Match Rule ID", type: "", default_value: "", required_on_create: true },
            reference_disabled: { name: "Reference Disabled", type: "", default_value: "", required_on_create: true },
            whitelisted_fb_ids: { name: "Whitelisted FB IDs", type: "", default_value: "", required_on_create: true },
            whitelisted_ig_ids: { name: "Whitelisted IG IDs", type: "", default_value: "", required_on_create: true },
            tags: { name: "Tags", type: "", default_value: "", required_on_create: true },
            action: { name: "Action", type: "", default_value: "CREATE", required_on_create: true }
        }

        const processFormField = (_field) => {
            let field = document.getElementById(_field);
            if (field !== null) {
                return field.value
            }

            return fields[_field].default_value;
        }

        const processFiles = () => {
            console.log("Files selected...");
            let values = {};
            let csvContent = "";
            for (const f in fields) {
                values[f] = processFormField(f);
                csvContent += fields[f].name + ",";
            }
            csvContent += "\n";
            console.log("Form values: ", values);
            console.log("CSV headings: ", csvContent);

            var inp = document.getElementById("video_files");
            // Access and handle the files

            for (let i = 0; i < inp.files.length; i++) {
                let file = inp.files[i];
                // do things with file
                values.filename = file.name;
                values.title = file.name;
                for (const f in values) {
                    csvContent += values[f] + ",";
                }
                csvContent += "\n";
                console.log("File", file.name);
            }
            console.log("CSV content: ", csvContent);
            return csvContent;
        }

        const save = (csvContent) => {
            console.log("Saving...");
            let filename = "csv_file.csv";
            var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            if (navigator.msSaveBlob) { // IE 10+
                navigator.msSaveBlob(blob, filename);
            } else {
                var link = document.createElement("a");
                if (link.download !== undefined) { // feature detection
                    // Browsers that support HTML5 download attribute
                    var url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }

        const exportCSV = () => {
            console.log("Exporting CSV file...");
            let csvContent = processFiles();
            save(csvContent);
        }

        /* ----- END: CSV Helpers ----- */

        /* ----- BEGIN: Form Components ----- */

        function Heading(){
            const classes = useStyles();
            return(
                <Typography variant="h4" className={classes.formTitle} gutterBottom>
                    RMSI - CSV Generator
                </Typography>
            )
        }

        function Files() {
            const classes = useStyles();
            return (
                <FormControl variant="outlined" className={classes.formControl}>
                    <label for="video_files">Files:</label>
                    <input type="file" name="video_files" id="video_files" multiple />
                </FormControl>
            )
        }

        function Territories() {

            const COUNTRIES = {
                WW: "World Wide",
                AF: "Afghanistan",
                AL: "Albania",
                DZ: "Algeria",
                AS: "American Samoa",
                AD: "Andorra",
                AO: "Angola",
                AI: "Anguilla",
                AQ: "Antarctica",
                AG: "Antigua and Barbuda",
                AR: "Argentina",
                AM: "Armenia",
                AW: "Aruba",
                AU: "Australia",
                AT: "Austria",
                AZ: "Azerbaijan",
            };

            function getClassName(country) {
                return (
                    territoryName.indexOf(country) === -1
                        ? classes.normalCountry
                        : classes.chosenCountry
                );
            }

            const classes = useStyles();
            const [territoryName, setTerritoryName] = React.useState([]);

            const handleChange = (event) => {
                setTerritoryName(event.target.value);
            };

            const handleChangeMultiple = (event) => {
                const { options } = event.target;
                const value = [];
                for (let i = 0, l = options.length; i < l; i += 1) {
                    if (options[i].selected) {
                        value.push(options[i].value);
                    }
                }
                setTerritoryName(value);
            };

            let countries = []
            for (const country in COUNTRIES) {
                countries.push(
                    <MenuItem key={country} value={country}
                        className={getClassName(country)}>
                        {COUNTRIES[country]}
                    </MenuItem>
                );
            }


            return (

                <div>
                    <FormControl variant="outlined" className={classes.formControl}>
                        <InputLabel id="territories-label">Territories</InputLabel>
                        <Select
                            labelId="territories-label"
                            id="territories"
                            name="territories"
                            multiple
                            value={territoryName}
                            onChange={handleChange}
                            input={<Input id="select-multiple-chip" />}
                            renderValue={(selected) => (
                                <div className={classes.chips}>
                                    {selected.map((value) => (
                                        <Chip key={value} label={value} className={classes.chip} />
                                    ))}
                                </div>
                            )}
                            MenuProps={MenuProps}
                        >
                            {countries}
                        </Select>
                    </FormControl>
                </div>

            )
        }

        function Category() {
            const classes = useStyles();
            const CATEGORY = {
                EPISODE: "Episode",
                MOVIE: "Movie",
                WEB: "Web",
            }


            let categories = []
            for (const category in CATEGORY) {
                categories.push(<MenuItem value={category}>{CATEGORY[category]}</MenuItem>)
            }

            return (
                <FormControl variant="outlined" className={classes.formControl}>
                    <InputLabel id="category-label">Category</InputLabel>
                    <Select
                        labelId="category-label"
                        id="category"
                        name="category"
                    >
                        {categories}
                    </Select>
                </FormControl>
            )
        }

        function MonitoringType() {
            const MONITORING_TYPE = {
                VIDEO_AND_AUDIO: "Video and audio",
                VIDEO_ONLY: "Video only",
                AUDIO_ONLY: "Audio only",
            }

            const classes = useStyles();

            let monitoring_types = []
            for (const mtype in MONITORING_TYPE) {
                monitoring_types.push(<MenuItem value={mtype}>{MONITORING_TYPE[mtype]}</MenuItem>)
            }

            return (
                <FormControl variant="outlined" className={classes.formControl}>
                    <InputLabel id="monitoring-type-label">Monitoring Type</InputLabel>
                    <Select
                        labelId="monitoring-type-label"
                        id="monitoring_type"
                        name="monitoring_type"
                    >
                        {monitoring_types}
                    </Select>
                </FormControl>
            )
        }

        function ReferenceDisabled() {
            const classes = useStyles();
            return (
                <FormControl className={classes.formControl}>
                    <FormControlLabel
                        control={
                            <Checkbox
                                name="reference_disabled"
                                color="primary"
                            />
                        }
                        label="Reference Disabled"
                    />
                </FormControl>
            )
        }

        function MatchRuleId() {
            const classes = useStyles();
            return (
                <FormControl className={classes.formControl}>
                    <TextField id="match_rule_id" name="match_rule_id" label="match_rule_id" variant="outlined" />
                </FormControl>
            )
        }

        function AllowedFBIds() {
            const classes = useStyles();
            return (
                <FormControl className={classes.formControl}>
                    <TextField id="whitelisted_fb_ids" name="whitelisted_fb_ids" label="whitelisted_fb_ids" variant="outlined" />
                </FormControl>
            )
        }

        function AllowedIGIds() {
            const classes = useStyles();
            return (
                <FormControl className={classes.formControl}>
                    <TextField id="whitelisted_ig_ids" name="whitelisted_ig_ids" label="whitelisted_ig_ids" variant="outlined" />
                </FormControl>
            )
        }

        function Tags() {
            const classes = useStyles();
            return (
                <FormControl className={classes.formControl}>
                    <TextField id="tags" name="tags" label="tags" variant="outlined" />
                </FormControl>
            )
        }

        function Description() {
            const classes = useStyles();
            return (
                <FormControl className={classes.formControl}>
                    <TextField
                        id="description"
                        label="Description"
                        multiline
                        rows={4}
                        defaultValue="Generic description for your files"
                        variant="outlined"
                    />
                </FormControl>
            )
        }
        /* ----- END: Form Components ----- */

        /* ----- BEGIN: React Main App ----- */
        function App() {
            const classes = useStyles();
            return (
                <Container maxWidth="b" className={classes.htmlBody}>
                <Container maxWidth="sm">
                    <Paper elevation={3}>
                        <Grid
                            container
                            direction="column"
                            justify="center"
                            alignItems="center"
                            className={classes.mainContainer}>
                            <Grid item xs>
                                <Heading/>
                            </Grid>
                            <Grid item xs>
                                <Files />
                            </Grid>
                            <Grid item xs>
                                <Territories />
                            </Grid>
                            <Grid item xs>
                                <Category />
                            </Grid>
                            <Grid item xs>
                                <MonitoringType />
                            </Grid>
                            <Grid item xs>
                                <MatchRuleId />
                            </Grid>
                            <Grid item xs>
                                <ReferenceDisabled />
                            </Grid>
                            <Grid item xs>
                                <AllowedFBIds />
                            </Grid>
                            <Grid item xs>
                                <AllowedIGIds />
                            </Grid>
                            <Grid item xs>
                                <Tags />
                            </Grid>
                            <Grid item xs>
                                <Description />
                            </Grid>
                            <Grid item xs>
                                <Button variant="contained" color="primary" onClick={exportCSV}>
                                    Export CSV
                                </Button>
                            </Grid>
                        </Grid>
                    </Paper>
                </Container>
                </Container>
            );
        }

        ReactDOM.render(
            <ThemeProvider theme={theme}>
                <CssBaseline />
                <App />
            </ThemeProvider>,
            document.querySelector('#root'),
        );

        /* ----- END: React Main App ----- */

    </script>
</body>

</html>
